<!DOCTYPE html>
<html dir="ltr" lang="en-US">
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  	<title>Documentation | Puppet Labs - Provider Development</title>
  	<meta name="description" content="The open source leader in data center automation">
  	<link rel="alternate" type="text/xml" title="Puppet Labs RSS 0.92 Feed" href="http://puppetlabs.com/feed/rss/">
  	<link rel="alternate" type="application/atom+xml" title="Puppet Labs Atom Feed" href="http://puppetlabs.com/feed/atom/">
  	<link rel="alternate" type="application/rss+xml" title="Puppet Labs RSS 2.0 Feed" href="http://puppetlabs.com/feed/">
  	<link rel="pingback" href="http://puppetlabs.com/xmlrpc.php">
    <link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://puppetlabs.com/xmlrpc.php?rsd" />
    <link rel='index' title='Puppet Labs' href='http://docs.puppetlabs.com' />

<!-- Google stats -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-1537572-5");
pageTracker._setDomainName(".puppetlabs.com");
pageTracker._trackPageview();
} catch(err) {}</script>
<!-- End Google stats -->


    <!-- FIXME: absolute paths -->

    <script type='text/javascript' src='/files/javascripts/html5.js'></script>
    <script type='text/javascript' src='/files/javascripts/jquery-1.3.2.min.js'></script>
    <script type='text/javascript' src='/files/javascripts/drop_down.js'></script>
    <script type='text/javascript' src='/files/javascripts/cufon-yui.js'></script>
    <script type='text/javascript' src='/files/fonts/Klavika_400-Klavika_600.font.js'></script>
    <script type='text/javascript' src='/files/javascripts/ampersands.js'></script>

    <!-- All in One SEO Pack 1.6.10.1 by Michael Torbert of Semper Fi Web Design[127,146] -->
    <meta name="keywords" content="Puppet, puppet labs, reductive labs, open source, system administrator, ruby, data center, automation, support" />
    <link rel="canonical" href="http://docs.puppetlabs.com" />
    <!-- /all in one seo pack -->
	
    <!-- FIXME: absolute paths -->

    <link rel="stylesheet" type="text/css" href="/files/stylesheets/style.css" media="screen"> <!-- index -->

    <!--[if IE 7]>
	  <link rel="stylesheet" type="text/css" href="/files/stylesheets/ie_7.css" media="screen"> <!-- index -->
    <![endif]-->
  
    <!--[if IE 8]>
	    <link rel="stylesheet" type="text/css" href="/files/stylesheets/ie_8.css" media="screen"> <!-- index -->
    <![endif]-->		

  	<script type="text/javascript">
      Cufon.replace('h1, h2', { fontWeight: '600' });
  	</script>
</head>



        
  <body id="resources" class="docs">
  <style type="text/css">h1, h2{ visibility : hidden }</style>		
  <!--[if IE 8]>
    <style type="text/css">h1, h2{ visibility : visible }</style>
  <![endif]-->		

  	<header id="header">
      <div class="site-width">
    		<h1><a href="http://puppetlabs.com/"><span>Puppet Labs</span></a></h1>
        <a class="screen-reader-content" href="#content">Skip navigation</a>
        <nav>
    		<ul id="global-navigation">
          <li id="puppet-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/puppet/">
              <span>Puppet</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>            
              <li>
                <ul>
                  <li class="page_item page-item-757"><a href="http://www.puppetlabs.com/puppet/introduction/" title="Introduction">Introduction</a></li>
<li class="page_item page-item-769"><a href="http://www.puppetlabs.com/puppet/requirements/" title="Requirements">Requirements</a></li>
<li class="page_item page-item-956"><a href="http://www.puppetlabs.com/puppet/solutions/" title="Solutions">Solutions</a></li>
<li class="page_item page-item-1159"><a href="http://www.puppetlabs.com/puppet/users/" title="Users">Users</a></li>

<li class="page_item page-item-2415"><a href="http://www.puppetlabs.com/puppet/what-customers-are-saying/" title="What Customers are Saying">What Customers are Saying</a></li>
                </ul>
              </li>
              <li>
                <ul>
                  <li class="page_item page-item-1977"><a href="http://forge.puppetlabs.com" title="Module Forge">Module Forge</a></li>
<li class="page_item page-item-751"><a href="http://www.puppetlabs.com/puppet/related-projects/dashboard/" title="Dashboard">Dashboard</a></li>
<li class="page_item page-item-753"><a href="http://www.puppetlabs.com/puppet/related-projects/facter/" title="Facter">Facter</a></li>

                </ul>
              </li>
            </ul>
          </li>
          <li id="services-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/services/">
              <span>Services</span>
              <span class="drop-down-trigger"></span>

            </a>
            <ul>
              <li class="page_item page-item-783"><a href="http://www.puppetlabs.com/services/overview/" title="Overview">Overview</a></li>
<li class="page_item page-item-839"><a href="http://www.puppetlabs.com/services/support/" title="Enterprise Support">Enterprise Support</a></li>
<li class="page_item page-item-845"><a href="http://www.puppetlabs.com/services/training-workshops/" title="On-Site Training &amp; Consulting">On-Site Training &amp; Consulting</a></li>
<li class="page_item page-item-849"><a href="/category/events/upcoming/" title="Events &amp; Public Training">Events &amp; Public Training</a></li>

<li class="page_item page-item-2424"><a href="http://www.puppetlabs.com/services/what-customers-are-saying/" title="What Customers are Saying">What Customers are Saying</a></li>
<li class="page_item page-item-851"><a href="http://www.puppetlabs.com/services/partners/" title="Partners">Partners</a></li>
<li class="page_item page-item-1037"><a href="/resources/customer-support" title="Customer Support">Customer Support</a></li>
            </ul>
          </li>
          <li id="resources-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/resources/">
              <span>Resources</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://www.puppetlabs.com/resources/overview-2/" title="Overview">Overview</a></li>
<li class="page_item page-item-833"><a href="http://www.puppetlabs.com/resources/case-studies/" title="Case Studies">Case Studies</a></li>
<li class="page_item page-item-1052"><a href="http://www.puppetlabs.com/resources/customer-support/" title="Customer Support">Customer Support</a></li>
<li class="page_item page-item-1040"><a href="http://docs.puppetlabs.com" title="Documentation">Documentation</a></li>
<li class="page_item page-item-872"><a href="http://info.puppetlabs.com/register-download" title="Downloads">Downloads</a></li>

<li class="page_item page-item-1961"><a href="http://forge.puppetlabs.com" title="Module Forge">Module Forge</a></li>
<li class="page_item page-item-835"><a href="http://info.puppetlabs.com/request-whitepapers.html" title="White Papers">White Papers</a></li>
<li class="page_item page-item-1967"><a href="http://projects.puppetlabs.com/projects/puppet/wiki" title="Wiki">Wiki</a></li>
            </ul>

          </li>
          <li id="community-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/community/">
              <span>Community</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-2195"><a href="http://www.puppetlabs.com/community/overview/" title="Overview">Overview</a></li>
<li class="page_item page-item-2264"><a href="http://www.puppetlabs.com/community/puppet-camp/" title="Puppet Camp">Puppet Camp</a></li>
<li class="page_item page-item-2249"><a href="http://www.puppetlabs.com/community/user-groups-and-devops-groups/" title="User Groups &amp; DevOps Groups">User Groups &amp; DevOps Groups</a></li>
<li class="page_item page-item-2215"><a href="http://www.puppetlabs.com/community/presentations/" title="Presentations">Presentations</a></li>

<li class="page_item page-item-2217"><a href="http://www.puppetlabs.com/community/videos/" title="Videos">Videos</a></li>
            </ul>
          </li>

          <li id="company-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/company/">
              <span>Company</span>
              <span class="drop-down-trigger"></span>
            </a>

            <ul>
              <li class="page_item page-item-2316"><a href="http://www.puppetlabs.com/company/overview/" title="Overview">Overview</a></li>
<li class="page_item page-item-2179"><a href="http://www.puppetlabs.com/company/news/" title="News">News</a></li>
<li class="page_item page-item-1571"><a href="http://www.puppetlabs.com/company/jobs/" title="Jobs">Jobs</a></li>
<li class="page_item page-item-2313"><a href="http://www.puppetlabs.com/company/contact-us/" title="Contact Us">Contact Us</a></li>
            </ul>
          </li>
    		</ul>	   
          <div id="misc-navigation">

			  <ul>
				<li><a href="http://docs.puppetlabs.com">Documentation</a></li>
				<li><a href="http://puppetlabs.com/resources/customer-support/">Support</a></li>
				<li><a href="http://puppetlabs.com/company/#contact">Contact Us</a></li>
				<li><a href="http://projects.puppetlabs.com/">Bug Tracker</a></li>
				<li><a href="http://puppetlabs.com/resources/downloads" class="gateway">Download</a></li>
			  </ul>
			<form action="http://www.google.com/cse" id="cse-search-box">

			  <div>
				<input type="hidden" name="cx" value="017884045025332504017:1mnj-dlgfcc" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" size="31" />
				<input type="submit" name="sa" class="searchbtn" value="Search" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en"></script>

          </div>
      </nav>
    	</div>
    </header>  

      <section id="masthead">
        <div class="site-width">
          <h1>Docs: <span class="section-name">Provider Development</span></h1>
          <ul id="doc-navigation">
            <li><a href="/">Docs Home</a></li>
            <li class="with-submenu">
              <a href="#">
                <span>Quick Nav</span>
                <span class="drop-down-trigger"></span>
              </a>
               <!-- the following links can't be relative, unfortunately -->
               <!-- future: add some JS to disable this if running from file:// -->
	            <dl>
	              <dt>Guides</dt>
	              <dd><a href="/index.html">Index</a></dd>
                      <dt>Resource Types</dt>
	              <dd><a href="/guides/types/">By Category</a></dd>
	              <dd><a href="/guides/types/alphabetical_index.html">Alphabetical</a></dd>
	              <dt>References</dt>
                      <dd><a href="/references/2.6.1/">2.6.1</a></dd>
                      <dd><a href="/references/2.6.0/">2.6.0</a></dd> 
                      <dd><a href="/references/0.25.5/">0.25.5</a></dd> 
	              <dd><a href="/references/0.24.8/">0.24.8</a></dd>
	              <dd><a href="/references/">Other Versions</a></dd>
	            </dl>
            </li>
            <li><a href="/contribute.html">Contribute</a></li>
          </ul>
        </div>
      </section>
    
      <section id="content">
        <div class="site-width">
          <div class="primary-secondary-content">
            <div class="primary-content">
              <h1 id='provider_development'>Provider Development</h1>

<p>Information about writing providers to provide implementation for types.</p>
              <h2 id='about'>About</h2>

<p>The core of Puppet&#8217;s cross-platform support is via Resource Providers, which are essentially back-ends that implement support for a specific implementation of a given resource type. For instance, there are more than 20 package providers, including providers for package formats like dpkg and rpm along with high-level package managers like apt and yum. A provider&#8217;s main job is to wrap client-side tools, usually by just calling out to those tools with the right information.</p>

<p>Not all resource types have or need providers, but any resource type concerned about portability will likely need them.</p>

<p>We will use the apt and dpkg package providers as examples throughout this document, and the examples used are current as of 0.23.0.</p>

<h1 id='declaration'>Declaration</h1>

<p>Providers are always associated with a single resource type, so they are created by calling the provide class method on that resource type. When declarating a provider, you can specify a parent class &#8211; for instance, all package providers have a common parent class:</p>

<pre><code>Puppet::Type.type(:package).provide :dpkg, :parent =&gt; Puppet::Provider::Package do
    desc &quot;...&quot;
    ...
end</code></pre>

<p>Note the call desc there; it sets the documentation for this provider, and should include everything necessary for someone to use this provider.</p>

<p>Providers can also specify another provider (from the same resource type) as their parent:</p>

<pre><code>Puppet::Type.type(:package).provide :apt, :parent =&gt; :dpkg, :source =&gt; :dpkg do
    ...
end</code></pre>

<p>Note that we&#8217;re also specifying that this provider uses the dpkg source; this tells Puppet to deduplicate packages from dpkg and apt, so the same package does not show up in an instance list from each provider type. Puppet defaults to creating a new source for each provider type, so you have to specify when a provider subclass shares a source with its parent class.</p>

<h1 id='suitability'>Suitability</h1>

<p>The first question to ask about a new provider is where it will be functional, which Puppet describes as suitable. Unsuitable providers cannot be used to do any work, although we&#8217;re working on making the suitability test late-binding, meaning that you could have a resource in your configuration that made a provider suitable. If you start puppetd or puppet in debug mode, you&#8217;ll see the results of failed provider suitability tests for the resource types you&#8217;re using.</p>

<p>Puppet providers include some helpful class-level methods you can use to both document and declare how to determine whether a given provider is suitable. The primary method is commands, which actually does two things for you: It declares that this provider requires the named binary, and it sets up class and instance methods with the name provided that call the specified binary. The binary can be fully qualified, in which case that specific path is required, or it can be unqualified, in which case Puppet will find the binary in the shell path and use that. If the binary cannot be found, then the provider is considered unsuitable. For example, here is the header for the dpkg provider (as of 0.23.0):</p>

<pre><code>commands :dpkg =&gt; &quot;/usr/bin/dpkg&quot;
commands :dpkg_deb =&gt; &quot;/usr/bin/dpkg-deb&quot;
commands :dpkgquery =&gt; &quot;/usr/bin/dpkg-query&quot;</code></pre>

<p>In addition to looking for binaries, Puppet can compare Facter facts, test for the existence of a file, or test whether a given value is true or false. For file extistence, truth, or false, just call the confine class method with exists, true, or false as the name of the test and your test as the value:</p>

<pre><code>confine :exists =&gt; &quot;/etc/debian_release&quot;
confine :true =&gt; Puppet.features.rrd?
confine :false =&gt; Puppet.features.rails?</code></pre>

<p>To test Facter values, just use the name of the fact:</p>

<pre><code>confine :operatingsystem =&gt; [:debian, :solaris]
confine :puppetversion =&gt; &quot;0.23.0&quot;</code></pre>

<p>Note that case doesn&#8217;t matter in the tests, nor does it matter whether the values are strings or symbols. It also doesn&#8217;t matter whether you specify an array or a single value &#8211; Puppet does an OR on the list of values.</p>

<h1 id='default_providers'>Default Providers</h1>

<p>Providers are generally meant to be hidden from the users, allowing them to focus on resource specification rather than implementation details. Toward this end, Puppet does what it can to choose an appropriate default provider for each resource type.</p>

<p>This is generally done by a single provider declaring that it is the default for a given set of facts, using the defaultfor class method. For instance, this is the apt provider&#8217;s declaration:</p>

<pre><code>defaultfor :operatingsystem =&gt; :debian</code></pre>

<p>The same fact matching functionality is used, so again case does not matter.</p>

<h1 id='providerresource_api'>Provider/Resource API</h1>

<p>Providers never do anything on their own; all of their action is triggered through an associated resource (or, in special cases, from the transaction). Because of this, resource types are essentially free to define their own provider interface if necessary, and providers were initially developed without a clear resource/provider API (mostly because it wasn&#8217;t clear whether such an API was necessary or what it would look like). At this point, however, there is a default interface between the resource type and the provider.</p>

<p>This interface consists entirely of getter and setter methods. When the resource is retrieving its current state, it iterates across all of its properties and calls the getter method on the provider for that property. For instance, when a user resource is having its state retrieved and its uid and shell properties are being managed, then the resource will call uid and shell on the provider to figure out what the current state of each of those properties is. This method call is in the retrieve method in Puppet::Property.</p>

<p>When a resource is being modified, it calls the equivalent setter method for each property on the provider. Again using our user example, if the uid was in sync but the shell was not, then the resource would call shell=(value) with the new shell value.</p>

<p>The transaction is responsible for storing these returned values and deciding which value to actually send, and it does its work through a PropertyChange instance. It calls sync on each of the properties, which in turn just call the setter by default.</p>

<p>You can override that interface as necessary for your resource type, but in the hopefully-near future this API will become more solidified.</p>

<p>Note that all providers must define an instances class method that returns a list of provider instances, one for each existing instance of that provider. For instance, the dpkg provider should return a provider instance for every package in the dpkg database.</p>

<h1 id='provider_methods'>Provider Methods</h1>

<p>By default, you have to define all of your getter and setter methods. For simple cases, this is sufficient &#8211; you just implement the code that does the work for that property.</p>

<p>However, because things are rarely so simple, Puppet attempts to help in a few ways.</p>

<h2 id='prefetching'>Prefetching</h2>

<p>First, Puppet transactions will prefetch provider information by calling prefetch on each used provider type. This calls the instances method in turn, which returns a list of provider instances with the current resource state already retrieved and stored in a @property_hash instance variable. The prefetch method then tries to find any matching resources, and assigns the retrieved providers to found resources. This way you can get information on all of the resources you&#8217;re managing in just a few method calls, instead of having to call all of the getter methods for every property being managed. Note that it also means that providers are often getting replaced, so you cannot maintain state in a provider.</p>

<h2 id='resource_methods'>Resource Methods</h2>

<p>For providers that directly modify the system when a setter method is called, there&#8217;s no substitute for defining them manually. But for resources that get flushed to disk in one step, such as the ParsedFile providers, there is a mk_resource_methods class method that creates a getter and setter for each property on the resource. These methods just retrieve and set the appropriate value in the @property_hash variable.</p>

<h2 id='flushing'>Flushing</h2>

<p>Many providers model files or parts of files, so it makes sense to save all of the writes up and do them in one run. Providers in need of this functionality can define a flush instance method to do this. The transaction will call this method after all values are synced (which means that the provider should have them all in its @property_hash variable) but before refresh is called on the resource (if appropriate).</p>
            </div>
            <div class="secondary-content">
                    <div id="subCol">
        <h3 class="chapter">Contents</h3>
        <ol class="chapters">
<li>
<a href="#provider_development">Provider Development</a><ul style="list-style: none;"><li><a href="#about">About</a></li></ul>
</li>
<li><a href="#declaration">Declaration</a></li>
<li><a href="#suitability">Suitability</a></li>
<li><a href="#default_providers">Default Providers</a></li>
<li><a href="#providerresource_api">Provider/Resource API</a></li>
<li>
<a href="#provider_methods">Provider Methods</a><ul style="list-style: none;">
<li><a href="#prefetching">Prefetching</a></li>
<li><a href="#resource_methods">Resource Methods</a></li>
<li><a href="#flushing">Flushing</a></li>
</ul>
</li></ol></div>
            </div>
          </div>
        </div>
      </section>

		<footer id="footer">
      <div class="site-width">
        <div class="primary-secondary-content">
          <div class="primary-content">
            <section id="newsletter">
                 <h4>Puppet Labs is Hiring</h4>
                 <p><a href="http://www.puppetlabs.com/company/jobs/">Engineers, developers & consultants</a>
                  <p>  
		<h4>Newsletter</h4>
              <p>Stay up to date on all things puppet</p>
              <form action="http://lfov.net/webrecorder/f" method="post" name="Newsletter" id="footerform">
                <input type="hidden" name="formid" value="3d424fd0-4204-435f-afde-aa1c4a6bc2f1"/>
                <input type="hidden" name="cid" value="LF_c268993e"/>
                <fieldset>
                  <legend>Newsletter</legend>
                  <label form="email">Email</label>
                  <input type="text" name="email" id="email" class="required email" />
                  <button type="submit">Subscribe</button>
                </fieldset>
              </form>

            </section>
            <section id="elsewhere">
              <h4>Get Involved</h4>
              <ul>
                <li class="chat"><a href="http://webchat.freenode.net/?channels=puppet" rel="external"><span class="indicator"></span><span>Chat with us on IRC</span></a></li>
                <li class="discussion"><a href="http://groups.google.com/group/puppet-users?pli=1" rel="external"><span class="indicator"></span><span>Join the Mailing List</span></a></li>
                
                <li class="linkedin"><a href="http://www.linkedin.com/groups?about=&gid=696467&trk=anet_ug_grppro" rel="external"><span class="indicator"></span><span>Join the Puppet Users LinkedIn group</span></a></li>

		

              </ul>
            </section>
          </div>
          <div class="secondary-content">
            <section id="book-it">
              <h4>Get the book!</h4>
              <p>Written by James Turnbull, <a href="http://apress.com/book/view/1590599780" rel="nofollow">Pulling Strings with Puppet</a> is the first book to introduce the powerful Puppet system administration tool. </p>
              <a href="http://apress.com/book/view/1590599780" rel="nofollow"><img src="http://puppetlabs.com/images/book.png" /></a>
            </section>
          </div>
        </div>
      </div>
		</footer>

    <div id="copyright">
      <div class="site-width">
        &copy; <?= date('Y'); ?> <a href="<?php bloginfo('url'); ?>/" title="<?php bloginfo('name'); ?>"><?php bloginfo('name'); ?></a>
        <span class="vcard">
         <span class="org"></span>
         <a class="email" href="mailto:info@puppetlabs.com">info@puppetlabs.com</a>
          <span class="adr">
           <span class="street-address">222 NW Davis Street</span>
           /
           <span class="locality">Portland</span>, 
           <span class="region">OR</span>
           <span class="postal-code">97209</span>

          </span>
         <span class="tel">1-877-575-9775</span>
        </span>          
      </div>
    </div>
    <script src="http://munchkin.marketo.net/munchkin.js" type="text/javascript"></script> <script>mktoMunchkin("307-QLA-991");</script> 
    <!-- BEGIN: LOOPFUSE TRACKING -->
    <script src="http://lfov.net/webrecorder/js/listen.js" type="text/Javascript"></script>
    <script type="text/Javascript">
    _lf_cid = "LF_c268993e";
    _lf_remora();
    </script>
    <!-- END: LOOPFUSE TRACKING -->
    
  	<script type="text/javascript">Cufon.now();</script>
  	<style type="text/css">h1, h2, .btn { visibility : visible; }</style>

	</body>
</html>        
