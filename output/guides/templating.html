<!DOCTYPE html>
<html dir="ltr" lang="en-US">
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  	<title>Documentation | Puppet Labs - Using Puppet Templates</title>
  	<meta name="description" content="The open source leader in data center automation">
  	<link rel="alternate" type="text/xml" title="Puppet Labs RSS 0.92 Feed" href="http://puppetlabs.com/feed/rss/">
  	<link rel="alternate" type="application/atom+xml" title="Puppet Labs Atom Feed" href="http://puppetlabs.com/feed/atom/">
  	<link rel="alternate" type="application/rss+xml" title="Puppet Labs RSS 2.0 Feed" href="http://puppetlabs.com/feed/">
  	<link rel="pingback" href="http://puppetlabs.com/xmlrpc.php">
    <link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://puppetlabs.com/xmlrpc.php?rsd" />
    <link rel='index' title='Puppet Labs' href='http://docs.puppetlabs.com' />

<!-- Google stats -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-1537572-5");
pageTracker._setDomainName(".puppetlabs.com");
pageTracker._trackPageview();
} catch(err) {}</script>
<!-- End Google stats -->


    <!-- FIXME: absolute paths -->

    <script type='text/javascript' src='/files/javascripts/html5.js'></script>
    <script type='text/javascript' src='/files/javascripts/jquery-1.3.2.min.js'></script>
    <script type='text/javascript' src='/files/javascripts/drop_down.js'></script>
    <script type='text/javascript' src='/files/javascripts/cufon-yui.js'></script>
    <script type='text/javascript' src='/files/fonts/Klavika_400-Klavika_600.font.js'></script>
    <script type='text/javascript' src='/files/javascripts/ampersands.js'></script>

    <!-- All in One SEO Pack 1.6.10.1 by Michael Torbert of Semper Fi Web Design[127,146] -->
    <meta name="keywords" content="Puppet, puppet labs, reductive labs, open source, system administrator, ruby, data center, automation, support" />
    <link rel="canonical" href="http://docs.puppetlabs.com" />
    <!-- /all in one seo pack -->
	
    <!-- FIXME: absolute paths -->

    <link rel="stylesheet" type="text/css" href="/files/stylesheets/style.css" media="screen"> <!-- index -->

    <!--[if IE 7]>
	  <link rel="stylesheet" type="text/css" href="/files/stylesheets/ie_7.css" media="screen"> <!-- index -->
    <![endif]-->
  
    <!--[if IE 8]>
	    <link rel="stylesheet" type="text/css" href="/files/stylesheets/ie_8.css" media="screen"> <!-- index -->
    <![endif]-->		

  	<script type="text/javascript">
      Cufon.replace('h1, h2', { fontWeight: '600' });
  	</script>
</head>



        
  <body id="resources" class="docs">
  <style type="text/css">h1, h2{ visibility : hidden }</style>		
  <!--[if IE 8]>
    <style type="text/css">h1, h2{ visibility : visible }</style>
  <![endif]-->		

  	<header id="header">
      <div class="site-width">
    		<h1><a href="http://puppetlabs.com/"><span>Puppet Labs</span></a></h1>
        <a class="screen-reader-content" href="#content">Skip navigation</a>
        <nav>
    		<ul id="global-navigation">
          <li id="puppet-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/puppet/">
              <span>Puppet</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>            
              <li>
                <ul>
                  <li class="page_item page-item-757"><a href="http://www.puppetlabs.com/puppet/introduction/" title="Introduction">Introduction</a></li>
<li class="page_item page-item-769"><a href="http://www.puppetlabs.com/puppet/requirements/" title="Requirements">Requirements</a></li>
<li class="page_item page-item-956"><a href="http://www.puppetlabs.com/puppet/solutions/" title="Solutions">Solutions</a></li>
<li class="page_item page-item-1159"><a href="http://www.puppetlabs.com/puppet/users/" title="Users">Users</a></li>

<li class="page_item page-item-2415"><a href="http://www.puppetlabs.com/puppet/what-customers-are-saying/" title="What Customers are Saying">What Customers are Saying</a></li>
                </ul>
              </li>
              <li>
                <ul>
                  <li class="page_item page-item-1977"><a href="http://forge.puppetlabs.com" title="Module Forge">Module Forge</a></li>
<li class="page_item page-item-751"><a href="http://www.puppetlabs.com/puppet/related-projects/dashboard/" title="Dashboard">Dashboard</a></li>
<li class="page_item page-item-753"><a href="http://www.puppetlabs.com/puppet/related-projects/facter/" title="Facter">Facter</a></li>

                </ul>
              </li>
            </ul>
          </li>
          <li id="services-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/services/">
              <span>Services</span>
              <span class="drop-down-trigger"></span>

            </a>
            <ul>
              <li class="page_item page-item-783"><a href="http://www.puppetlabs.com/services/overview/" title="Overview">Overview</a></li>
<li class="page_item page-item-839"><a href="http://www.puppetlabs.com/services/support/" title="Enterprise Support">Enterprise Support</a></li>
<li class="page_item page-item-845"><a href="http://www.puppetlabs.com/services/training-workshops/" title="On-Site Training &amp; Consulting">On-Site Training &amp; Consulting</a></li>
<li class="page_item page-item-849"><a href="/category/events/upcoming/" title="Events &amp; Public Training">Events &amp; Public Training</a></li>

<li class="page_item page-item-2424"><a href="http://www.puppetlabs.com/services/what-customers-are-saying/" title="What Customers are Saying">What Customers are Saying</a></li>
<li class="page_item page-item-851"><a href="http://www.puppetlabs.com/services/partners/" title="Partners">Partners</a></li>
<li class="page_item page-item-1037"><a href="/resources/customer-support" title="Customer Support">Customer Support</a></li>
            </ul>
          </li>
          <li id="resources-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/resources/">
              <span>Resources</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://www.puppetlabs.com/resources/overview-2/" title="Overview">Overview</a></li>
<li class="page_item page-item-833"><a href="http://www.puppetlabs.com/resources/case-studies/" title="Case Studies">Case Studies</a></li>
<li class="page_item page-item-1052"><a href="http://www.puppetlabs.com/resources/customer-support/" title="Customer Support">Customer Support</a></li>
<li class="page_item page-item-1040"><a href="http://docs.puppetlabs.com" title="Documentation">Documentation</a></li>
<li class="page_item page-item-872"><a href="http://info.puppetlabs.com/register-download" title="Downloads">Downloads</a></li>

<li class="page_item page-item-1961"><a href="http://forge.puppetlabs.com" title="Module Forge">Module Forge</a></li>
<li class="page_item page-item-835"><a href="http://info.puppetlabs.com/request-whitepapers.html" title="White Papers">White Papers</a></li>
<li class="page_item page-item-1967"><a href="http://projects.puppetlabs.com/projects/puppet/wiki" title="Wiki">Wiki</a></li>
            </ul>

          </li>
          <li id="community-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/community/">
              <span>Community</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-2195"><a href="http://www.puppetlabs.com/community/overview/" title="Overview">Overview</a></li>
<li class="page_item page-item-2264"><a href="http://www.puppetlabs.com/community/puppet-camp/" title="Puppet Camp">Puppet Camp</a></li>
<li class="page_item page-item-2249"><a href="http://www.puppetlabs.com/community/user-groups-and-devops-groups/" title="User Groups &amp; DevOps Groups">User Groups &amp; DevOps Groups</a></li>
<li class="page_item page-item-2215"><a href="http://www.puppetlabs.com/community/presentations/" title="Presentations">Presentations</a></li>

<li class="page_item page-item-2217"><a href="http://www.puppetlabs.com/community/videos/" title="Videos">Videos</a></li>
            </ul>
          </li>

          <li id="company-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/company/">
              <span>Company</span>
              <span class="drop-down-trigger"></span>
            </a>

            <ul>
              <li class="page_item page-item-2316"><a href="http://www.puppetlabs.com/company/overview/" title="Overview">Overview</a></li>
<li class="page_item page-item-2179"><a href="http://www.puppetlabs.com/company/news/" title="News">News</a></li>
<li class="page_item page-item-1571"><a href="http://www.puppetlabs.com/company/jobs/" title="Jobs">Jobs</a></li>
<li class="page_item page-item-2313"><a href="http://www.puppetlabs.com/company/contact-us/" title="Contact Us">Contact Us</a></li>
            </ul>
          </li>
    		</ul>	   
          <div id="misc-navigation">

			  <ul>
				<li><a href="http://docs.puppetlabs.com">Documentation</a></li>
				<li><a href="http://puppetlabs.com/resources/customer-support/">Support</a></li>
				<li><a href="http://puppetlabs.com/company/#contact">Contact Us</a></li>
				<li><a href="http://projects.puppetlabs.com/">Bug Tracker</a></li>
				<li><a href="http://puppetlabs.com/resources/downloads" class="gateway">Download</a></li>
			  </ul>
			<form action="http://www.google.com/cse" id="cse-search-box">

			  <div>
				<input type="hidden" name="cx" value="017884045025332504017:1mnj-dlgfcc" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" size="31" />
				<input type="submit" name="sa" class="searchbtn" value="Search" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en"></script>

          </div>
      </nav>
    	</div>
    </header>  

      <section id="masthead">
        <div class="site-width">
          <h1>Docs: <span class="section-name">Using Puppet Templates</span></h1>
          <ul id="doc-navigation">
            <li><a href="/">Docs Home</a></li>
            <li class="with-submenu">
              <a href="#">
                <span>Quick Nav</span>
                <span class="drop-down-trigger"></span>
              </a>
               <!-- the following links can't be relative, unfortunately -->
               <!-- future: add some JS to disable this if running from file:// -->
	            <dl>
	              <dt>Guides</dt>
	              <dd><a href="/index.html">Index</a></dd>
                      <dt>Resource Types</dt>
	              <dd><a href="/guides/types/">By Category</a></dd>
	              <dd><a href="/guides/types/alphabetical_index.html">Alphabetical</a></dd>
	              <dt>References</dt>
                      <dd><a href="/references/2.6.1/">2.6.1</a></dd>
                      <dd><a href="/references/2.6.0/">2.6.0</a></dd> 
                      <dd><a href="/references/0.25.5/">0.25.5</a></dd> 
	              <dd><a href="/references/0.24.8/">0.24.8</a></dd>
	              <dd><a href="/references/">Other Versions</a></dd>
	            </dl>
            </li>
            <li><a href="/contribute.html">Contribute</a></li>
          </ul>
        </div>
      </section>
    
      <section id="content">
        <div class="site-width">
          <div class="primary-secondary-content">
            <div class="primary-content">
              <h1 id='using_puppet_templates'>Using Puppet Templates</h1>

<p>Learn how to template out configuration files with Puppet, filling in variables from the client system from facter.</p>
              <p>Puppet supports templates and templating via <a href='http://www.ruby-doc.org/stdlib/libdoc/erb/rdoc/'>ERB</a>, which is part of the Ruby standard library and is used for many other projects including Ruby on Rails. While it is a Ruby templating system, you do not need to understand much Ruby to use ERB.</p>

<p>Templates allow you to manage the content of template files, for example configuration files that cannot yet be managed directly by a built-in Puppet type. This might include an Apache configuration file, Samba configuration file, etc.</p>

<h2 id='evaluating_templates'>Evaluating templates</h2>

<p>Templates are evaluated via a simple function:</p>

<pre><code>$value = template(&quot;mytemplate.erb&quot;)</code></pre>

<p>You can specify the full path to your template, or you can put all your templates in Puppet&#8217;s templatedir, which usually defaults to <code>/var/puppet/templates</code> (you can find out what it is on your system by running <code>puppet --configprint templatedir</code>). Best practices indicates including the template in the <code>templates</code> directory inside your <span>Module</span> (./modules.html).</p>

<p>Templates are always evaluated by the parser, not by the client. This means that if you are using puppetmasterd, then the templates only need to be on the server, and you never need to download them to the client. There&#8217;s no difference that the client sees between using a template and specifying all of the text of the file as a string. This also means that any client-specific variables (facts) are learned first by puppetmasterd during the client start-up phase, then those variables are available for substitution within templates.</p>

<h2 id='using_templates'>Using templates</h2>

<p>Here is an example for generating the Apache configuration for <a href='http://trac.edgewall.org/'>Trac</a> sites:</p>

<pre><code>define tracsite($cgidir, $tracdir) {
    file { &quot;trac-$name&quot;:
        path =&gt; &quot;/etc/apache2/trac/$name.conf&quot;,
        owner =&gt; root,
        group =&gt; root,
        mode =&gt; 644,
        require =&gt; File[apacheconf],
        content =&gt; template(&quot;tracsite.erb&quot;),
        notify =&gt; Service[apache2]
    }

    symlink { &quot;tracsym-$name&quot;:
        path =&gt; &quot;$cgidir/$name.cgi&quot;,
        ensure =&gt; &quot;/usr/share/trac/cgi-bin/trac.cgi&quot;
    }
}</code></pre>

<p>And then here&#8217;s the template:</p>

<pre><code>&lt;Location &quot;/cgi-bin/ &lt;%= name %&gt;.cgi&quot;&gt;
    SetEnv TRAC_ENV &quot;/export/svn/trac/&lt;%= name %&gt;&quot;
&lt;/Location&gt; 

# You need something like this to authenticate users
&lt;Location &quot;/cgi-bin/&lt;%= name %&gt;.cgi/login&quot;&gt;
    AuthType Basic 
    AuthName &quot;Trac&quot; 
    AuthUserFile /etc/apache2/auth/svn
    Require valid-user
&lt;/Location&gt;</code></pre>

<p>This puts each Trac configuration into a separate file, and then we just tell Apache to load all of these files:</p>

<pre><code>Include /etc/apache2/trac/[^.#]*</code></pre>

<h2 id='combining_templates'>Combining templates</h2>

<p>You can also concatentate several templates together as follows:</p>

<pre><code> template(&#39;/path/to/template1&#39;,&#39;/path/to/template2&#39;)</code></pre>

<h2 id='iteration'>Iteration</h2>

<p>Puppet&#8217;s templates also support array iteration. If the variable you are accessing is an array, you can iterate over it in a loop. Given Puppet manifest code like this:</p>

<pre><code>$values = [val1, val2, otherval]</code></pre>

<p>You could have a template like this:</p>

<pre><code>&lt;% values.each do |val| -%&gt; 
Some stuff with &lt;%= val %&gt; 
&lt;% end -%&gt;</code></pre>

<p>This would produce:</p>

<pre><code>Some stuff with val1
Some stuff with val2
Some stuff with otherval</code></pre>

<p>Note that normally, ERB template lines that just have code on them would get translated into blank lines. This is because ERB generates newlines by default. To prevent this, we use the closing tag -%&gt; instead of %&gt;.</p>

<p>As we mentioned, erb is a Ruby system, but you don&#8217;t need to know Ruby well to use ERB. Internally, Puppet&#8217;s values get translated to real Ruby values, including true and false, so you can be pretty confident that variables will behave as you might expect.</p>

<h2 id='conditionals'>Conditionals</h2>

<p>The ERB templating supports conditionals. The following construct is a quick and easy way to conditionally put content into a file:</p>

<pre><code>&lt;% if broadcast != &quot;NONE&quot; %&gt;        broadcast &lt;%= broadcast %&gt; &lt;% end %&gt;</code></pre>

<h2 id='templates_and_variables'>Templates and variables</h2>

<p>You can also use templates to fill in variables in addition to filling out file contents.</p>

<pre><code>myvariable = template(&#39;/var/puppet/template/myvar&#39;)</code></pre>

<h2 id='undefined_variables'>Undefined variables</h2>

<p>If you need to test to see if a variable is defined before using it, the following works:</p>

<pre><code>&lt;% if has_variable?(&quot;myvar&quot;) then %&gt;
myvar has &lt;%= myvar %&gt; value
&lt;% end %&gt;</code></pre>

<h2 id='out_of_scope_variables'>Out of scope variables</h2>

<p>You can access out of scope variables explicitly with the lookupvar function:</p>

<pre><code>&lt;%= scope.lookupvar(&#39;apache::user&#39;) %&gt;</code></pre>

<h2 id='access_to_defined_tags_and_classes'>Access to defined tags and classes</h2>

<p>In Puppet version 0.24.6 and later, it is possible from a template to get the list of defined classes, the list of tags in the current scope, and the list of all tags as ruby arrays. For example:</p>

<p>This snippet will print all the tags defined in the current scope:</p>

<pre><code>&lt;% tags.each do |tag| -%&gt;
The tag &lt;%= tag %&gt; is part of the current scope
&lt;% end -%&gt;</code></pre>

<p>This snippet will print all the defined tags in the catalog:</p>

<pre><code>&lt;% all_tags.each do |tag| -%&gt;
The tag &lt;%= tag %&gt; is defined
&lt;% end -%&gt;</code></pre>

<p>And this snippet will print all the defined class in the catalog:</p>

<pre><code>&lt;% classes.each do |klass| -%&gt;
The class &lt;%= klass %&gt; is defined
&lt;% end -%&gt;</code></pre>

<h2 id='syntax_checking'>Syntax Checking</h2>

<p>ERB files are easy to syntax check. For a file mytemplate.erb, run</p>

<pre><code>erb -x -T &#39;-&#39; mytemplate.erb | ruby -c</code></pre>
            </div>
            <div class="secondary-content">
                    <div id="subCol">
        <h3 class="chapter">Contents</h3>
        <ol class="chapters">
<li><a href="#evaluating_templates">Evaluating templates</a></li>
<li><a href="#using_templates">Using templates</a></li>
<li><a href="#combining_templates">Combining templates</a></li>
<li><a href="#iteration">Iteration</a></li>
<li><a href="#conditionals">Conditionals</a></li>
<li><a href="#templates_and_variables">Templates and variables</a></li>
<li><a href="#undefined_variables">Undefined variables</a></li>
<li><a href="#out_of_scope_variables">Out of scope variables</a></li>
<li><a href="#access_to_defined_tags_and_classes">Access to defined tags and classes</a></li>
<li><a href="#syntax_checking">Syntax Checking</a></li></ol></div>
            </div>
          </div>
        </div>
      </section>

		<footer id="footer">
      <div class="site-width">
        <div class="primary-secondary-content">
          <div class="primary-content">
            <section id="newsletter">
                 <h4>Puppet Labs is Hiring</h4>
                 <p><a href="http://www.puppetlabs.com/company/jobs/">Engineers, developers & consultants</a>
                  <p>  
		<h4>Newsletter</h4>
              <p>Stay up to date on all things puppet</p>
              <form action="http://lfov.net/webrecorder/f" method="post" name="Newsletter" id="footerform">
                <input type="hidden" name="formid" value="3d424fd0-4204-435f-afde-aa1c4a6bc2f1"/>
                <input type="hidden" name="cid" value="LF_c268993e"/>
                <fieldset>
                  <legend>Newsletter</legend>
                  <label form="email">Email</label>
                  <input type="text" name="email" id="email" class="required email" />
                  <button type="submit">Subscribe</button>
                </fieldset>
              </form>

            </section>
            <section id="elsewhere">
              <h4>Get Involved</h4>
              <ul>
                <li class="chat"><a href="http://webchat.freenode.net/?channels=puppet" rel="external"><span class="indicator"></span><span>Chat with us on IRC</span></a></li>
                <li class="discussion"><a href="http://groups.google.com/group/puppet-users?pli=1" rel="external"><span class="indicator"></span><span>Join the Mailing List</span></a></li>
                
                <li class="linkedin"><a href="http://www.linkedin.com/groups?about=&gid=696467&trk=anet_ug_grppro" rel="external"><span class="indicator"></span><span>Join the Puppet Users LinkedIn group</span></a></li>

		

              </ul>
            </section>
          </div>
          <div class="secondary-content">
            <section id="book-it">
              <h4>Get the book!</h4>
              <p>Written by James Turnbull, <a href="http://apress.com/book/view/1590599780" rel="nofollow">Pulling Strings with Puppet</a> is the first book to introduce the powerful Puppet system administration tool. </p>
              <a href="http://apress.com/book/view/1590599780" rel="nofollow"><img src="http://puppetlabs.com/images/book.png" /></a>
            </section>
          </div>
        </div>
      </div>
		</footer>

    <div id="copyright">
      <div class="site-width">
        &copy; <?= date('Y'); ?> <a href="<?php bloginfo('url'); ?>/" title="<?php bloginfo('name'); ?>"><?php bloginfo('name'); ?></a>
        <span class="vcard">
         <span class="org"></span>
         <a class="email" href="mailto:info@puppetlabs.com">info@puppetlabs.com</a>
          <span class="adr">
           <span class="street-address">222 NW Davis Street</span>
           /
           <span class="locality">Portland</span>, 
           <span class="region">OR</span>
           <span class="postal-code">97209</span>

          </span>
         <span class="tel">1-877-575-9775</span>
        </span>          
      </div>
    </div>
    <script src="http://munchkin.marketo.net/munchkin.js" type="text/javascript"></script> <script>mktoMunchkin("307-QLA-991");</script> 
    <!-- BEGIN: LOOPFUSE TRACKING -->
    <script src="http://lfov.net/webrecorder/js/listen.js" type="text/Javascript"></script>
    <script type="text/Javascript">
    _lf_cid = "LF_c268993e";
    _lf_remora();
    </script>
    <!-- END: LOOPFUSE TRACKING -->
    
  	<script type="text/javascript">Cufon.now();</script>
  	<style type="text/css">h1, h2, .btn { visibility : visible; }</style>

	</body>
</html>        
